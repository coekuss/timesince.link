<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport">
    <title>timesince.link</title>
    <style>
        body {
            margin: 0;
            font-family: sans-serif;
            font-style: italic;
        }
        #wrapper {
            display: grid;
            place-items: center;
            height: 100vh;
        }
        #content {
            max-width: 1000px;
            font-size: 4em;
            padding: 0px 20px 0px 20px;
            text-align: center;
            color: white;
            text-shadow: 0px 0px 1.5px currentColor;
        }
        .fadein {
            color: black !important;
            transition: color 2s;
        }
        #menulines {
            float: left;
            width: 75px;
            position: fixed;
            margin: 20px;
            cursor: pointer;
        }
        svg {
            stroke: black;
            stroke-width: 12;
            stroke-linecap: round;
            overflow: visible;
            width: 100%;
        }
        #line1 {
            transition: 0.2s;
        }
        #line2 {
            margin: 10px 0px 10px 0px;
        }
        #line3 {
            transition: 0.2s;
        }
        #menulines:hover #line1 {
            transform: translateY(-6px);
            transition: 0.2s;
        }
        #menulines:hover #line3 {
            transform: translateY(6px);
            transition: 0.2s;
        }
        #aboutwrapper {
            display: grid;
            place-items: center;
            position: absolute;
            margin: none;
            width: 100%;
            height: 100%;
            pointer-events: none;
        }
        #about {
            width: 75%;
            height: 85%;
            max-width: 1000px;
            overflow-y: auto;
            background-color: white;
            border-radius: 10px;
            box-shadow: 0px 0px 50px -10px black;
            font-size: 2em;
            text-shadow: 0px 0px 1px currentColor;
            padding: 0px 50px 0px 50px;
            pointer-events: none;
            opacity: 0;
            transition: opacity 0.1s;
        }
        #aboutHomeLink {
            text-decoration: none;
            color: black;
            transition: letter-spacing 0.2s;
        }
        #aboutHomeLink:hover {
            letter-spacing: 2px;
        }
        .show {
            opacity: 1 !important;
            pointer-events: all !important;
        }
        #xbuttonline {
            text-align: right;
        }
        #xbuttoncontainer {
            display: inline-block;
            text-align: right;
            width: fit-content;
            width: 100%;
            margin-top: 30px;
        }
        #xbuttonclickable {
            display: inline;
            cursor: pointer;
            width: fit-content;
            padding: 5px;
        }
        #xbutton {
            width: 30px;
            stroke: black;
            stroke-width: 60;
            stroke-linecap: round;
        }
        #content p {
            margin: 30px 0px 30px 0px;
        }
        input {
            min-height: fit-content;
            border-radius: 10px;
            border: 5px solid black;
            font-family: sans-serif;
            font-style: italic;
            font-size: 0.7em;
            padding: 10px;
            text-shadow: 0px 0px 1.5px currentColor;
        }
        #userEvent {
            resize: none;
            overflow: visible;
            width: 477px;
            min-height: fit-content;
            border-radius: 10px;
            border: 5px solid black;
            font-family: sans-serif;
            font-style: italic;
            font-size: 0.7em;
            padding: 10px;
            text-shadow: 0px 0px 1.5px currentColor;

        }
        #generateLinkButton {
            cursor: pointer;
            background: none;
            transition: transform 0.2s;
            margin-top: 30px;
        }
        #generateLinkButton:hover {
            transform: scale(1.05)
        }
    </style>
    <script>
        function getQueryVariable(variable) {
                var query = window.location.search.substring(1);
                var vars = query.split("&");
                for (var i = 0; i < vars.length; i++) {
                    var pair = vars[i].split("=");
                    if (pair[0] == variable) { return pair[1]; }
                }
                return (false);
        }
        function timeSinceDate(timeUnit, userDate) {
            const oneDay = 24 * 60 * 60 * 1000; // hours*minutes*seconds*milliseconds
            const oneWeek = oneDay * 7
            const oneMonth = oneDay * 30
            const oneYear = oneDay * 365

            const dateSplit = userDate.split("-")

            // subtract 1 because Date() function has 0-indexed months
            const userMonth = dateSplit[0] - 1 
            const userDay = dateSplit[1]
            const userYear = dateSplit[2]

            const firstDate = new Date(userYear, userMonth, userDay);
            const secondDate = Date.now();

            const diffDays = Math.round(Math.abs((firstDate - secondDate) / oneDay));

            switch(timeUnit) {
                case "days":
                    return diffDays + " days"
                case "weeks":
                    return Math.round(diffDays / 7) + " weeks"
                case "months":
                    return Math.round(diffDays / 30) + " months"
                case "years":
                    return Math.round(diffDays / 365) + " years"
            }
            
        }
        function toggleAbout() {
            if (document.getElementById("about").classList.contains("show")) {
                document.getElementById("about").classList.remove("show")
            } else {
                document.getElementById("about").classList.add("show")
            }
        }
        // use this function to round to 1 decimal place
        // https://stackoverflow.com/questions/7342957/how-do-you-round-to-1-decimal-place-in-javascript
        function round(value, precision) {
            var multiplier = Math.pow(10, precision || 0);
            return Math.round(value * multiplier) / multiplier;
        }
        window.onload = function() {
            if (window.location.search == "") {
                document.getElementById("content").innerHTML = `
                <form method="GET">
                    <p><label for="event">What happened?</label></p>
                    <p><textarea class="userText" id="userEvent" rows="2" name="e" required></textarea></p>
                    <p><label for="timesince">When did it happen?</label></p>
                    <p><input class="userText" id="userDate" type="text" pattern="[0-9]{1,2}-[0-9]{1,2}-[0-9]{4}" placeholder="M-D-YYYY" name="d" required></p>
                    <p><input id="generateLinkButton" type="submit" value="Generate Link"></p>
                </form>
                `;
            } else {
                document.getElementById("event").innerHTML = getQueryVariable("e").replace(/\+/g, " ");
                if (getQueryVariable("u") == false) {
                    document.getElementById("timesince").innerHTML = timeSinceDate("days", getQueryVariable("d"))
                } else {
                    document.getElementById("timesince").innerHTML = timeSinceDate(getQueryVariable("u"), getQueryVariable("d"))
                }
                
            }
            
            document.getElementById("content").classList.add("fadein")
        }
    </script>
</head>
<body>
    <div id="menulines" onclick="toggleAbout()">
        <svg id="line1" viewBox="0 0 168 33" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd"
            stroke-linejoin="round" stroke-miterlimit="2">
            <path d="M0 32C9 32 19 0 28 0s19 32 28 32S75 0 84 0s19 32 28 32 19-32 28-32 19 32 28 32" fill="none" />
        </svg>
        <svg id="line2" viewBox="0 0 168 33" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd"
            stroke-linejoin="round" stroke-miterlimit="2">
            <path d="M0 32C9 32 19 0 28 0s19 32 28 32S75 0 84 0s19 32 28 32 19-32 28-32 19 32 28 32" fill="none" />
        </svg>
        <svg id="line3" viewBox="0 0 168 33" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd" clip-rule="evenodd"
            stroke-linejoin="round" stroke-miterlimit="2">
            <path d="M0 32C9 32 19 0 28 0s19 32 28 32S75 0 84 0s19 32 28 32 19-32 28-32 19 32 28 32" fill="none" />
        </svg>
    </div>

    <div id="aboutwrapper">
        <div id="about">
            <div id="xbuttoncontainer">
                <div id="xbuttonclickable" onclick="toggleAbout()">
                    <svg id="xbutton" viewBox="0 0 305 305" xmlns="http://www.w3.org/2000/svg" fill-rule="evenodd"
                        clip-rule="evenodd" stroke-linejoin="round" stroke-miterlimit="2">
                        <path d="M305 0L0 305M0 0l305 305" fill="none" />
                    </svg>
                </div>
            </div>
        
            <h2><a href="index.html" id="aboutHomeLink">timesince.link</a></h2>
            <p>A tool made by <a href="https://coekuss.com/">Coekuss</a> to help you
                appreciate life events and new habits. Adding structure to your personal
                progress.
            </p>
            <p>The link contains all the info about your event so you can
                bookmark it, send it to people, or whatever else.
            </p>
        </div>
    </div>
    
    <div id="wrapper">
        <div id="content">
            <p>It has been</p>
            <div id="timesinceWrapper">
                <p id="timesince"></p>
            </div>
            <p>since</p>
            <p id="event"></p>
            
        </div>
    </div>
</body>
</html>